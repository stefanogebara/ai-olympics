<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Olympics - Code Golf Challenge</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #fff;
    }

    .timer {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.6);
      padding: 15px 25px;
      border-radius: 10px;
      font-family: monospace;
      font-size: 1.5rem;
      color: #00d4ff;
      z-index: 100;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 30px;
    }

    .header h1 {
      font-size: 2.5rem;
      background: linear-gradient(90deg, #6bcb77, #ffd93d, #4d96ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
      margin-bottom: 10px;
    }

    .header p { color: #a0aec0; text-align: center; margin-bottom: 25px; }

    .problem-card {
      background: rgba(75, 150, 255, 0.1);
      border: 1px solid rgba(75, 150, 255, 0.3);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
    }

    .problem-card h3 { color: #4d96ff; margin-bottom: 12px; }
    .problem-card p { color: #cbd5e0; line-height: 1.7; }

    .examples {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      margin-top: 12px;
      font-family: monospace;
      font-size: 14px;
    }

    .examples .label { color: #6bcb77; }
    .examples .value { color: #c9d1d9; }

    .stats-bar {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px 20px;
      flex: 1;
      text-align: center;
    }

    .stat-label { color: #a0aec0; font-size: 0.85rem; }
    .stat-value { font-size: 1.5rem; font-weight: bold; color: #00d4ff; margin-top: 5px; }
    .stat-value.good { color: #48bb78; }
    .stat-value.warn { color: #ffd93d; }

    .editor-label {
      display: block;
      color: #a0aec0;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .code-editor {
      width: 100%;
      height: 250px;
      background: #0d1117;
      color: #c9d1d9;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      padding: 16px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      tab-size: 2;
    }

    .code-editor:focus {
      outline: none;
      border-color: #7c3aed;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .run-btn {
      flex: 1;
      padding: 14px;
      background: linear-gradient(90deg, #48bb78, #38a169);
      border: none;
      border-radius: 10px;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
    }

    .submit-btn {
      flex: 1;
      padding: 14px;
      background: linear-gradient(90deg, #7c3aed, #00d4ff);
      border: none;
      border-radius: 10px;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
    }

    .test-output {
      background: #0d1117;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      font-family: monospace;
      font-size: 13px;
      line-height: 1.5;
      max-height: 250px;
      overflow-y: auto;
    }

    .test-pass { color: #48bb78; }
    .test-fail { color: #fc8181; }

    .success-message {
      display: none;
      text-align: center;
      padding: 60px 40px;
    }

    .success-message.show { display: block; }
    .success-message h2 { color: #48bb78; margin-bottom: 15px; }
    .success-message p { color: #a0aec0; }
  </style>
</head>
<body>
  <div class="timer" id="timer">00:00.00</div>

  <div class="container" id="mainContainer">
    <div class="header">
      <h1>Code Golf Challenge</h1>
      <p>Write the shortest correct solution. Fewer characters = higher score!</p>
    </div>

    <div class="problem-card">
      <h3>Problem: FizzBuzz Transform</h3>
      <p>Write a function <code style="background:rgba(0,0,0,0.3);padding:2px 6px;border-radius:4px;color:#ffd93d;">solve(n)</code> that takes an integer <code style="background:rgba(0,0,0,0.3);padding:2px 6px;border-radius:4px;color:#ffd93d;">n</code> and returns an array of strings from 1 to n where:</p>
      <ul style="margin:10px 0 0 20px;color:#cbd5e0;">
        <li>Numbers divisible by 3 are replaced with "Fizz"</li>
        <li>Numbers divisible by 5 are replaced with "Buzz"</li>
        <li>Numbers divisible by both 3 and 5 are replaced with "FizzBuzz"</li>
        <li>Other numbers are converted to strings</li>
      </ul>
      <div class="examples">
        <div><span class="label">Input:  </span><span class="value">solve(5)</span></div>
        <div><span class="label">Output: </span><span class="value">["1", "2", "Fizz", "4", "Buzz"]</span></div>
        <div style="margin-top:8px;"><span class="label">Input:  </span><span class="value">solve(15)</span></div>
        <div><span class="label">Output: </span><span class="value">["1", "2", "Fizz", "4", "Buzz", "Fizz", "7", "8", "Fizz", "Buzz", "11", "Fizz", "13", "14", "FizzBuzz"]</span></div>
      </div>
    </div>

    <div class="stats-bar">
      <div class="stat">
        <div class="stat-label">Character Count</div>
        <div class="stat-value" id="charCount">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">Tests Passed</div>
        <div class="stat-value" id="testsPassedStat">- / 4</div>
      </div>
      <div class="stat">
        <div class="stat-label">Golf Rating</div>
        <div class="stat-value" id="golfRating">-</div>
      </div>
    </div>

    <label class="editor-label" for="codeEditor">Write your solution:</label>
    <textarea id="codeEditor" class="code-editor" aria-label="Code Editor" spellcheck="false">function solve(n) {
  // Your code here
}</textarea>

    <div class="btn-row">
      <button class="run-btn" id="runBtn" aria-label="Run Tests">Run Tests</button>
      <button class="submit-btn" id="submitBtn" aria-label="Submit Solution">Submit Solution</button>
    </div>

    <div class="test-output" id="testOutput">Click "Run Tests" to check your solution.</div>
  </div>

  <div class="success-message" id="successMessage">
    <h2>Solution Submitted!</h2>
    <p>Tests passed: <span id="finalPassed">0</span> / <span id="finalTotal">4</span></p>
    <p>Character count: <span id="finalChars">0</span></p>
    <p>Completed in <span id="completionTime">0.00</span> seconds</p>
    <p style="margin-top:15px;font-size:0.9rem;">Submission ID: <code id="submissionId"></code></p>
  </div>

  <script>
    var startTime = Date.now();
    var timerEl = document.getElementById('timer');

    function updateTimer() {
      var elapsed = Date.now() - startTime;
      var minutes = Math.floor(elapsed / 60000);
      var seconds = Math.floor((elapsed % 60000) / 1000);
      var millis = Math.floor((elapsed % 1000) / 10);
      timerEl.textContent = String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0') + '.' + String(millis).padStart(2, '0');
      requestAnimationFrame(updateTimer);
    }
    updateTimer();

    var editor = document.getElementById('codeEditor');
    var charCountEl = document.getElementById('charCount');

    editor.addEventListener('input', function() {
      var code = editor.value.trim();
      var len = code.length;
      charCountEl.textContent = String(len);
      if (len > 0 && len <= 80) {
        charCountEl.className = 'stat-value good';
      } else if (len <= 150) {
        charCountEl.className = 'stat-value warn';
      } else {
        charCountEl.className = 'stat-value';
      }
    });

    editor.addEventListener('keydown', function(e) {
      if (e.key === 'Tab') {
        e.preventDefault();
        var start = this.selectionStart;
        var end = this.selectionEnd;
        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);
        this.selectionStart = this.selectionEnd = start + 2;
      }
    });

    var testCases = [
      { input: 1, expected: ['1'] },
      { input: 5, expected: ['1', '2', 'Fizz', '4', 'Buzz'] },
      { input: 15, expected: ['1', '2', 'Fizz', '4', 'Buzz', 'Fizz', '7', '8', 'Fizz', 'Buzz', '11', 'Fizz', '13', '14', 'FizzBuzz'] },
      { input: 16, expected: ['1', '2', 'Fizz', '4', 'Buzz', 'Fizz', '7', '8', 'Fizz', 'Buzz', '11', 'Fizz', '13', '14', 'FizzBuzz', '16'] }
    ];

    // Evaluate user code in a sandboxed iframe for the coding challenge
    function evaluateSolve(code, input) {
      var iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      document.body.appendChild(iframe);

      try {
        var iframeDoc = iframe.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write('<scr' + 'ipt>' + code + '; window.__result = solve(' + input + ');</' + 'scr' + 'ipt>');
        iframeDoc.close();
        var result = iframe.contentWindow.__result;
        document.body.removeChild(iframe);
        return result;
      } catch (err) {
        document.body.removeChild(iframe);
        throw err;
      }
    }

    function addLine(container, text, cssClass) {
      var div = document.createElement('div');
      if (cssClass) div.className = cssClass;
      div.textContent = text;
      container.appendChild(div);
    }

    function runTests() {
      var code = editor.value;
      var output = document.getElementById('testOutput');
      var passed = 0;

      while (output.firstChild) output.removeChild(output.firstChild);

      try {
        testCases.forEach(function(tc, i) {
          var actual = evaluateSolve(code, tc.input);
          var actualStr = JSON.stringify(actual);
          var expectedStr = JSON.stringify(tc.expected);

          if (actualStr === expectedStr) {
            addLine(output, 'PASS Test ' + (i + 1) + ': solve(' + tc.input + ') = ' + actualStr, 'test-pass');
            passed++;
          } else {
            addLine(output, 'FAIL Test ' + (i + 1) + ': solve(' + tc.input + ')', 'test-fail');
            addLine(output, '  Expected: ' + expectedStr, 'test-fail');
            addLine(output, '  Got:      ' + actualStr, 'test-fail');
          }
        });
      } catch (err) {
        addLine(output, 'ERROR: ' + err.message, 'test-fail');
      }

      document.getElementById('testsPassedStat').textContent = passed + ' / ' + testCases.length;

      var charLen = code.trim().length;
      var rating = '-';
      if (passed === testCases.length) {
        if (charLen <= 60) rating = 'Ace';
        else if (charLen <= 100) rating = 'Pro';
        else if (charLen <= 150) rating = 'Good';
        else rating = 'OK';
      }
      document.getElementById('golfRating').textContent = rating;

      addLine(output, 'Passed: ' + passed + ' / ' + testCases.length + ' | Chars: ' + charLen, '');

      return { passed: passed, total: testCases.length, chars: charLen };
    }

    document.getElementById('runBtn').addEventListener('click', runTests);

    document.getElementById('submitBtn').addEventListener('click', function() {
      var testResult = runTests();
      var completionTime = ((Date.now() - startTime) / 1000).toFixed(2);
      var code = editor.value;

      document.getElementById('mainContainer').style.display = 'none';
      var success = document.getElementById('successMessage');
      success.classList.add('show');
      document.getElementById('completionTime').textContent = completionTime;
      document.getElementById('finalPassed').textContent = String(testResult.passed);
      document.getElementById('finalTotal').textContent = String(testResult.total);
      document.getElementById('finalChars').textContent = String(testResult.chars);
      document.getElementById('submissionId').textContent = 'GLF-' + Math.random().toString(36).substr(2, 9).toUpperCase();

      console.log('CODE_GOLF_COMPLETE', {
        completionTime: parseFloat(completionTime),
        timestamp: Date.now(),
        submission: code,
        charCount: testResult.chars,
        testsPassed: testResult.passed,
        testsTotal: testResult.total
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Olympics - Chess Challenge</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      padding: 30px;
      color: #fff;
    }
    .header { text-align: center; margin-bottom: 30px; }
    .header h1 { font-size: 2.2rem; background: linear-gradient(90deg, #00d4ff, #7c3aed, #ff6b6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
    .timer { position: fixed; top: 20px; right: 20px; background: rgba(0, 0, 0, 0.6); padding: 15px 25px; border-radius: 10px; font-family: monospace; font-size: 1.5rem; color: #00d4ff; z-index: 100; }
    .progress-bar { max-width: 700px; margin: 0 auto 30px; background: rgba(255, 255, 255, 0.1); height: 10px; border-radius: 5px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #7c3aed, #00d4ff); transition: width 0.3s; }
    .stats-bar { display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; }
    .stat { text-align: center; }
    .stat-value { font-size: 1.5rem; font-weight: bold; color: #00d4ff; }
    .stat-label { font-size: 0.8rem; color: #a0aec0; }
    .puzzle-container { max-width: 700px; margin: 0 auto; }
    .puzzle-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 30px; margin-bottom: 20px; }
    .puzzle-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .puzzle-number { color: #7c3aed; font-size: 0.9rem; }
    .turn-indicator { padding: 6px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 600; }
    .turn-white { background: rgba(255, 255, 255, 0.2); color: white; }
    .turn-black { background: rgba(0, 0, 0, 0.4); color: #a0aec0; }
    .puzzle-description { color: #e2e8f0; line-height: 1.6; font-size: 1rem; margin-bottom: 20px; text-align: center; }
    .chess-board-container { display: flex; justify-content: center; margin: 20px 0; }
    .chess-board { font-family: 'Courier New', monospace; font-size: 1.1rem; line-height: 1.4; background: rgba(0, 0, 0, 0.3); padding: 15px 20px; border-radius: 10px; white-space: pre; }
    .input-section { margin-top: 25px; }
    .input-label { color: #a0aec0; font-size: 0.9rem; margin-bottom: 10px; display: block; }
    .input-group { display: flex; gap: 10px; }
    .answer-input { flex: 1; padding: 14px; background: rgba(255, 255, 255, 0.08); border: 2px solid rgba(255, 255, 255, 0.15); border-radius: 10px; color: white; font-size: 1.1rem; text-align: center; font-family: monospace; }
    .answer-input:focus { outline: none; border-color: #7c3aed; }
    .answer-input::placeholder { color: #4a5568; }
    .submit-btn { padding: 14px 30px; background: linear-gradient(90deg, #7c3aed, #00d4ff); border: none; border-radius: 10px; color: white; font-size: 1rem; font-weight: 600; cursor: pointer; }
    .submit-btn:disabled { background: #4a5568; cursor: not-allowed; }
    .notation-help { margin-top: 15px; padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; font-size: 0.85rem; color: #a0aec0; }
    .feedback { margin-top: 15px; padding: 12px; border-radius: 8px; text-align: center; font-weight: 500; }
    .feedback.correct { background: rgba(72, 187, 120, 0.2); color: #48bb78; }
    .feedback.incorrect { background: rgba(252, 129, 129, 0.2); color: #fc8181; }
    .hidden { display: none; }
    .success-screen { text-align: center; padding: 40px; max-width: 600px; margin: 0 auto; }
    .success-icon { font-size: 4rem; margin-bottom: 20px; }
    .success-screen h2 { color: #48bb78; font-size: 2rem; margin-bottom: 15px; }
    .score-display { font-size: 3rem; font-weight: bold; color: #00d4ff; margin: 20px 0; }
    .results-summary { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 25px 0; }
    .result-item { background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; }
    .result-item-value { font-size: 1.5rem; font-weight: bold; color: #00d4ff; }
    .result-item-label { font-size: 0.85rem; color: #a0aec0; }
    .results-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 20px; }
    .result-box { padding: 15px 10px; border-radius: 8px; text-align: center; }
    .result-box.correct { background: rgba(72, 187, 120, 0.2); color: #48bb78; }
    .result-box.incorrect { background: rgba(252, 129, 129, 0.2); color: #fc8181; }
  </style>
</head>
<body>
  <div class="timer" id="timer">00:00</div>

  <div class="header">
    <h1>Chess Challenge</h1>
    <p style="color: #a0aec0;">Find the best move in 5 chess puzzles!</p>
  </div>

  <div class="progress-bar">
    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
  </div>

  <div class="stats-bar">
    <div class="stat">
      <div class="stat-value" id="scoreDisplay">0</div>
      <div class="stat-label">Score</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="correctDisplay">0</div>
      <div class="stat-label">Correct</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="puzzleNum">1/5</div>
      <div class="stat-label">Puzzle</div>
    </div>
  </div>

  <div class="puzzle-container" id="puzzleContainer"></div>

  <div class="success-screen hidden" id="successScreen">
    <div class="success-icon">CHESS</div>
    <h2>Challenge Complete!</h2>
    <div class="score-display">Score: <span id="finalScore">0</span>/1000</div>
    <div class="results-summary">
      <div class="result-item">
        <div class="result-item-value" id="finalCorrect">0</div>
        <div class="result-item-label">Correct Moves</div>
      </div>
      <div class="result-item">
        <div class="result-item-value" id="finalTime">0s</div>
        <div class="result-item-label">Total Time</div>
      </div>
      <div class="result-item">
        <div class="result-item-value" id="avgTime">0s</div>
        <div class="result-item-label">Avg Per Puzzle</div>
      </div>
      <div class="result-item">
        <div class="result-item-value" id="accuracy">0%</div>
        <div class="result-item-label">Accuracy</div>
      </div>
    </div>
    <div class="results-grid" id="resultsGrid"></div>
  </div>

  <script>
    // Chess puzzles with ASCII board representation
    // Pieces: K=King, Q=Queen, R=Rook, B=Bishop, N=Knight, P=Pawn
    // Uppercase = White, lowercase = black
    const puzzles = [
      {
        title: 'Back Rank Mate',
        description: 'White to move. Find the checkmate in one move!',
        toMove: 'white',
        board: [
          '  a b c d e f g h',
          '8 . . . . . r k .',
          '7 . . . . . p p p',
          '6 . . . . . . . .',
          '5 . . . . . . . .',
          '4 . . . . . . . .',
          '3 . . . . . . . .',
          '2 . . . . . . . .',
          '1 . . . . R . K .'
        ],
        answer: ['Re8', 'Re8#', 'Re8+'],
        explanation: 'Re8# delivers checkmate on the back rank'
      },
      {
        title: 'Knight Fork',
        description: 'White to move. Win material with a knight fork!',
        toMove: 'white',
        board: [
          '  a b c d e f g h',
          '8 r . . . k . . r',
          '7 p p p . . p p p',
          '6 . . . . . . . .',
          '5 . . . . . . . .',
          '4 . . . . q . . .',
          '3 . . N . . . . .',
          '2 P P P . . P P P',
          '1 R . . . K . . R'
        ],
        answer: ['Nd5', 'Nc3-d5'],
        explanation: 'Nd5 forks the king and queen'
      },
      {
        title: 'Discovered Attack',
        description: 'White to move. Use the bishop to reveal an attack!',
        toMove: 'white',
        board: [
          '  a b c d e f g h',
          '8 r . . q k . . r',
          '7 p p p . . p p p',
          '6 . . . . . . . .',
          '5 . . . B . . . .',
          '4 . . . . . . . .',
          '3 . . . . . . . .',
          '2 P P P . . P P P',
          '1 R . . Q K . . R'
        ],
        answer: ['Bxf7+', 'Bf7+', 'Bxf7'],
        explanation: 'Bxf7+ checks the king and discovers an attack on the queen'
      },
      {
        title: 'Queen Sacrifice',
        description: 'White to move. Find the brilliant queen sacrifice!',
        toMove: 'white',
        board: [
          '  a b c d e f g h',
          '8 r . . . . r k .',
          '7 p p . . . . p p',
          '6 . . . . . . . .',
          '5 . . . . . . . .',
          '4 . . . . . . . .',
          '3 . . . . . . . Q',
          '2 P P . . . . P P',
          '1 R . . . R . K .'
        ],
        answer: ['Qxh7+', 'Qh7+', 'Qxh7'],
        explanation: 'Qxh7+ forces Kxh7 followed by Rh1+ and Rh8#'
      },
      {
        title: 'Smothered Mate',
        description: 'White to move. Execute the famous smothered mate pattern!',
        toMove: 'white',
        board: [
          '  a b c d e f g h',
          '8 . . . . . r k .',
          '7 . . . . . p p p',
          '6 . . . . . N . .',
          '5 . . . . Q . . .',
          '4 . . . . . . . .',
          '3 . . . . . . . .',
          '2 . . . . . . . .',
          '1 . . . . . . K .'
        ],
        answer: ['Qg8+', 'Qg8'],
        explanation: 'Qg8+ forces Rxg8, then Nf7# is smothered mate'
      }
    ];

    // State
    let currentPuzzle = 0;
    let answers = [];
    let score = 0;
    let correctCount = 0;
    let startTime = Date.now();

    // DOM Elements
    const timerEl = document.getElementById('timer');
    const progressFill = document.getElementById('progressFill');
    const puzzleContainer = document.getElementById('puzzleContainer');
    const successScreen = document.getElementById('successScreen');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const correctDisplay = document.getElementById('correctDisplay');
    const puzzleNum = document.getElementById('puzzleNum');

    // Update timer
    function updateTimer() {
      setInterval(function() {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        timerEl.textContent = String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
      }, 1000);
    }

    function renderPuzzle(index) {
      const p = puzzles[index];
      progressFill.style.width = ((index / puzzles.length) * 100) + '%';
      puzzleNum.textContent = (index + 1) + '/' + puzzles.length;

      // Clear container
      while (puzzleContainer.firstChild) {
        puzzleContainer.removeChild(puzzleContainer.firstChild);
      }

      const card = document.createElement('div');
      card.className = 'puzzle-card';

      // Header
      const header = document.createElement('div');
      header.className = 'puzzle-header';

      const numSpan = document.createElement('span');
      numSpan.className = 'puzzle-number';
      numSpan.textContent = 'Puzzle ' + (index + 1) + ': ' + p.title;

      const turnSpan = document.createElement('span');
      turnSpan.className = 'turn-indicator turn-' + p.toMove;
      turnSpan.textContent = p.toMove.charAt(0).toUpperCase() + p.toMove.slice(1) + ' to move';

      header.appendChild(numSpan);
      header.appendChild(turnSpan);

      // Description
      const descDiv = document.createElement('div');
      descDiv.className = 'puzzle-description';
      descDiv.textContent = p.description;

      // Chess board
      const boardContainer = document.createElement('div');
      boardContainer.className = 'chess-board-container';

      const boardPre = document.createElement('pre');
      boardPre.className = 'chess-board';
      boardPre.textContent = p.board.join('\n');

      boardContainer.appendChild(boardPre);

      // Input section
      const inputSection = document.createElement('div');
      inputSection.className = 'input-section';

      const inputLabel = document.createElement('label');
      inputLabel.className = 'input-label';
      inputLabel.textContent = 'Enter your move in algebraic notation:';

      const inputGroup = document.createElement('div');
      inputGroup.className = 'input-group';

      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'answer-input';
      input.id = 'answerInput';
      input.placeholder = 'e.g., e4, Nf3, O-O, Bxc6';
      input.setAttribute('aria-label', 'Enter your chess move');

      const submitBtn = document.createElement('button');
      submitBtn.className = 'submit-btn';
      submitBtn.id = 'submitBtn';
      submitBtn.textContent = 'Submit Move';

      inputGroup.appendChild(input);
      inputGroup.appendChild(submitBtn);

      // Notation help
      const helpDiv = document.createElement('div');
      helpDiv.className = 'notation-help';
      helpDiv.textContent = 'Notation: K=King, Q=Queen, R=Rook, B=Bishop, N=Knight. Examples: e4 (pawn to e4), Nf3 (knight to f3), Bxc6 (bishop captures on c6), O-O (kingside castle)';

      inputSection.appendChild(inputLabel);
      inputSection.appendChild(inputGroup);
      inputSection.appendChild(helpDiv);

      // Feedback area
      const feedbackDiv = document.createElement('div');
      feedbackDiv.className = 'feedback hidden';
      feedbackDiv.id = 'feedback';

      card.appendChild(header);
      card.appendChild(descDiv);
      card.appendChild(boardContainer);
      card.appendChild(inputSection);
      card.appendChild(feedbackDiv);

      puzzleContainer.appendChild(card);

      // Event listeners
      submitBtn.onclick = submitAnswer;
      input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') submitAnswer();
      });

      input.focus();
    }

    function submitAnswer() {
      const input = document.getElementById('answerInput');
      const userAnswer = input.value.trim();

      if (!userAnswer) {
        input.style.borderColor = '#fc8181';
        return;
      }

      const p = puzzles[currentPuzzle];

      // Check if answer matches any acceptable answer (case-insensitive)
      const normalizedUser = userAnswer.toLowerCase().replace(/[+#]/g, '');
      const isCorrect = p.answer.some(function(ans) {
        return ans.toLowerCase().replace(/[+#]/g, '') === normalizedUser;
      });

      // Calculate points
      let points = 0;
      if (isCorrect) {
        points = 200; // 200 points per correct answer
        score += points;
        correctCount++;
      }

      answers.push({
        puzzleIndex: currentPuzzle,
        userAnswer: userAnswer,
        correct: isCorrect,
        points: points
      });

      // Update displays
      scoreDisplay.textContent = score;
      correctDisplay.textContent = correctCount;

      // Show feedback
      const feedback = document.getElementById('feedback');
      feedback.classList.remove('hidden', 'correct', 'incorrect');
      feedback.classList.add(isCorrect ? 'correct' : 'incorrect');
      feedback.textContent = isCorrect
        ? 'Correct! ' + p.explanation
        : 'Incorrect. The best move was ' + p.answer[0] + '. ' + p.explanation;

      // Disable input
      input.disabled = true;
      document.getElementById('submitBtn').disabled = true;

      setTimeout(function() {
        nextPuzzle();
      }, 2500);
    }

    function nextPuzzle() {
      if (currentPuzzle < puzzles.length - 1) {
        currentPuzzle++;
        renderPuzzle(currentPuzzle);
      } else {
        showResults();
      }
    }

    function showResults() {
      const totalTime = (Date.now() - startTime) / 1000;
      const avgTime = totalTime / puzzles.length;
      const finalScore = Math.min(1000, score);

      puzzleContainer.classList.add('hidden');
      progressFill.style.width = '100%';
      successScreen.classList.remove('hidden');

      document.getElementById('finalScore').textContent = finalScore;
      document.getElementById('finalCorrect').textContent = correctCount + '/' + puzzles.length;
      document.getElementById('finalTime').textContent = totalTime.toFixed(1) + 's';
      document.getElementById('avgTime').textContent = avgTime.toFixed(1) + 's';
      document.getElementById('accuracy').textContent = Math.round((correctCount / puzzles.length) * 100) + '%';

      const resultsGrid = document.getElementById('resultsGrid');
      while (resultsGrid.firstChild) {
        resultsGrid.removeChild(resultsGrid.firstChild);
      }

      answers.forEach(function(answer, i) {
        const box = document.createElement('div');
        box.className = 'result-box ' + (answer.correct ? 'correct' : 'incorrect');

        const pLabel = document.createElement('div');
        pLabel.textContent = 'P' + (i + 1);

        const result = document.createElement('div');
        result.textContent = answer.correct ? 'OK' : 'X';

        box.appendChild(pLabel);
        box.appendChild(result);
        resultsGrid.appendChild(box);
      });

      console.log('CHESS_COMPLETE', {
        completionTime: totalTime,
        timestamp: Date.now(),
        correctCount: correctCount,
        totalPuzzles: puzzles.length,
        answers: answers,
        score: finalScore
      });
    }

    // Start
    renderPuzzle(0);
    updateTimer();
  </script>
</body>
</html>
